#{extends "organization/crudHeader.html" /}
#{set 'visibility'}hidden#{/set}

<div class="row">
    <div class="span12">

        <table class="table table-striped">
            <caption>&{titleKey}</caption>
            <thead>
            <tr>
                #{list columnLabels, as: 'label'}
                <th>&{label}</th>
                #{/list}
                <th width="25%">&{'thing.actions'}</th>
            </tr>
            </thead>
            <!-- ko if: items().length > 0 -->
            <tbody data-bind="foreach: items()">
            <tr>
               #{list columnFields, as: 'field'}
                <td>
                    <span class="node-title" data-bind="text: ${field}"></span>
                </td>
                #{/list}
                <td>
                    <a class="btn btn-primary btn-mini" href="#" data-bind="click: function() { $parent.update($data) }" rel="nofollow">
                        <i class="icon-edit icon-white"></i> &{'ui.label.edit'}
                    </a>
                    <a class="btn btn-danger btn-mini pull-right delete" href="#" data-bind="click: function() { $parent.delete($data) }" rel="nofollow">
                        <i class="icon-trash icon-white"></i> &{'ui.label.delete'}
                    </a>
                </td>
            </tr>
            </tbody>
            <!-- /ko -->
            <!-- ko ifnot: items().length > 0 -->
            <tbody>
            <tr>
                <td colspan="2">
                    No items
                </td>
                <td>
                    <a class="btn btn-primary btn-mini" href="${request.uri()}/add" rel="nofollow">${messages.get('ui.label.new')}</a>
                </td>
            </tr>
            </tbody>
            <!-- /ko -->
        </table>

    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {

        var viewModel = {
            update: function(item) {
                document.location = location.href + "/" + item.id() + "/update"
            },
            delete: function(item) {
                bootboxConfirm({
                    'type': 'DELETE',
                    'message' : '<h3 class="shout">' + item.name() + '</h3>&{'thing.deleteConfirmation'}',
                    'action_url' : location.href + "/" + item.id() + '/remove',
                    'success_callback' : function () {
                        viewModel.items.remove(function (item) {
                            return item.key === item.key;
                        });
                    }

                });
            }
        };

        load(location.href, viewModel, null, function () {
            $("body").css('visibility', 'visible');
        });
    });
</script>