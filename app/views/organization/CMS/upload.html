#{extends viewUtils.themeProperty('themeLayout') /}

#{set title: viewUtils.getKey('org.cms.upload') /}

#{set bodyId: 'organization' /}

#{breadcrumbs /}

#{organizationNavBar orgId: orgId, active:"site", isOwner: isOwner, isCMSAdmin: isCMSAdmin /}

<!--
  ~ Copyright 2012 Delving B.V.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="row">
    <div class="grid_12">
        <div class="sub-panel clearfix">
            #{cmsNavBar active:'image', currentLanguage:currentLanguage, orgId: orgId/}
        </div>
        <div class="panel">
            <p>&{'org.cms.upload.image.explain'}</p>
        </div>
    </div>
</div>

<div class="row">
    <div class="grid_12">

        <div id="fileupload">

            <form action="#" method="post" enctype="multipart/form-data">
                <div class="fileupload-buttonbar">
                    <label class="fileinput-button">
                        <span>&{'ui.label.filesadd'}</span>
                        <input type="file" name="files[]" multiple="true"/>
                    </label>
                </div>
            </form>
            <div class="fileupload-content">
                <table class="files"></table>
            </div>

        </div>
    </div>


</div>


<script type="text/javascript">
    $(document).ready(function () {

        initUploadWidget(false);

        $('#fileupload').fileupload({
            url: '@{user.FileUpload.uploadFile(uid)}',
            autoUpload: true
        }).bind('fileuploaddone', function (e, data) {
            $.post('/organizations/${orgId}/site/upload/${uid}', function() {
                document.location = '/organizations/${orgId}/site/upload';
            });
        });

        var files = ${files.raw()};
        var fu = $('#fileupload').data('fileupload');
        fu._adjustMaxNumberOfFiles(-files.length);
        fu._renderDownload(files)
                .appendTo($('#fileupload .files'))
                .fadeIn(function () {
                    // Fix for IE7 and lower:
                    $(this).show();
                });

        $("body").css('visibility', 'visible');


    });

</script>