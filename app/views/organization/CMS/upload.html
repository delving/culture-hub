#{extends themeInfo.get('themeLayout') /}

#{set title: messages.get('org.cms.upload') /}

#{set bodyId: 'organization' /}

#{set 'moreCss'}
<link rel="stylesheet" type="text/css" href="@{routes.Assets.at("common/stylesheets/fileupload/jquery.fileupload-ui.css")}"/>
#{/set}

#{set 'moreScripts'}
<script type="text/javascript" src="@{routes.Assets.at("common/javascripts/fileupload/jquery.iframe-transport.js")}"></script>
<script type="text/javascript" src="@{routes.Assets.at("common/javascripts/fileupload/jquery.fileupload.js")}"></script>
<script type="text/javascript" src="@{routes.Assets.at("common/javascripts/fileupload/jquery.fileupload-fp.js")}"></script>
<script type="text/javascript" src="@{routes.Assets.at("common/javascripts/fileupload/jquery.fileupload-ui.js")}"></script>
<script type="text/javascript" src="@{routes.Assets.at("common/javascripts/fileupload/upload.js")}"></script>
#{/set}

#{breadcrumbs request: request, theme: themeInfo.getTheme() /}

#{organizationNavBar orgId: orgId, active:"site", isOwner: isOwner, isCMSAdmin: isCMSAdmin, currentLanguage: currentLanguage /}

<div class="row">
    <div class="span12">
        <p>&{'org.cms.upload.image.explain'}</p>
    </div>
</div>
<form id="fileupload" action="#" method="POST" enctype="multipart/form-data">
<div class="row">
        <div class="span12">
           <!-- The fileupload-buttonbar contains buttons to add/delete files and start/cancel the upload -->
           <div class="row fileupload-buttonbar">
               <div class="span7">
                   <!-- The fileinput-button span is used to style the file input field as button -->
                   <span class="btn btn-success fileinput-button">
                       <i class="icon-plus icon-white"></i>
                       <span>&{'org.cms.upload.image'}</span>
                       <input type="file" name="files[]" multiple >
                   </span>
                   <button type="button" class="btn btn-danger delete">
                       <i class="icon-trash icon-white"></i>
                       <span>Delete</span>
                   </button>
                   <input type="checkbox" class="toggle">
               </div>
               <div class="span5">
                   <!-- The global progress bar -->
                   <div class="progress progress-success progress-striped active fade">
                       <div class="bar" style="width:0%;"></div>
                   </div>
               </div>
           </div>
           <!-- The loading indicator is shown during file processing -->
           <div class="fileupload-loading"></div>
        </div>
</div>
    <div class="row">
        <div class="span12">
           <!-- The table listing the files available for upload/download -->
           <table class="table table-striped" style="margin-top: 21px;">
               <caption>Uploaded files</caption>
               <thead>
               <th>Thumbnail</th>
               <th>File name</th>
               <th>File size</th>
               <th colspan="2"></th>
               <th>Actions</th>
               </thead>
               <tbody class="files" data-toggle="modal-gallery" data-target="#modal-gallery"></tbody></table>
        </div>
</div>
</form>
<script type="text/javascript">
    $(document).ready(function () {

        $('#fileupload').fileupload({
            url: '@{controllers.user.routes.FileUpload.uploadFile(uid)}',
            autoUpload: true,
            uploadTemplate: _renderUploadTemplate,
            downloadTemplate: _renderDownloadTemplate
        }).bind('fileuploaddone', function (e, data) {
                    $.post('/organizations/${orgId}/site/upload/${uid}');
                });

        var files = ${files.raw()};
        $('#fileupload').each(function () {
            var that = this;
            $(that).fileupload('option', 'done').call(that, null, {result: files});
        });

        $("body").css('visibility', 'visible');
        $("table.files td.delete button").addClass("btn btn-danger");

    });

</script>