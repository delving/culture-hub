#{extends 'header.html' /}
#{set title: id == None ? 'Add new Portal Theme' : 'Update Portal Theme' /}

<div class="grid_8">
  <h1>${id == None? 'Add a new theme' : 'Update a theme'}</h1>

  <form id="themeForm" method="post" action="">
    <span class="required-note"><span>*</span> Required Fields</span>
    #{textField name: "name", label: "Name", dataBind: "value: name", help: "", disabled: false, labelClass: "required" /}
    #{checkboxField name: "isDefault", label: "Is default", dataBind: "checked: isDefault" /}
    #{textField name: "displayName", label: "Display Name", dataBind: "value: displayName" /}
    #{textField name: "templateDir", label: "Template directory", dataBind: "value: templateDir" /}
    #{textField name: "googleAnalyticsTrackingCode", label: "Google Analytics code", dataBind: "value: googleAnalyticsTrackingCode" /}
    #{textField name: "addThisTrackingCode", label: "Add this code", dataBind: "value: addThisTrackingCode" /}
    #{textField name: "defaultLanguage", label: "Default language", dataBind: "value: defaultLanguage" /}
    #{textField name: "colorScheme", label: "Color scheme", dataBind: "value: colorScheme" /}
    #{textField name: "solrSelectUrl", label: "Solr select URL", dataBind: "value: solrSelectUrl" /}
    #{textField name: "cacheUrl", label: "Cache URL", dataBind: "value: cacheUrl" /}
    #{textField name: "homePage", label: "Homepage", dataBind: "value: homePage" /}
    <div class="field">
      <label for="localisedQueryKeys">Localised query keys</label>

      <div>
        <select id="localisedQueryKeys" multiple="multiple" width="50" name="localisedQueryKeys" data-bind="options: localisedQueryKeys, selectedOptions: selectedQueryKeys"></select>
        <input id="addQueryKey" data-bind='value: addQueryKeys, valueUpdate: "afterkeydown"'/>
        <button type="button" data-bind="enable: addQueryKeys().length > 0, click: function() { this.addItem(); }">Add</button>
        <button data-bind="click: function() { this.removeSelected(); }, enable: selectedQueryKeys().length > 0">Remove</button>
      </div>
    </div>
    #{textField name: "metadataPrefix", label: "Metadata prefix", dataBind: "value: metadataPrefix" /}
    #{textField name: "hiddenQueryFilter", label: "Hidden Query filter", dataBind: "value: hiddenQueryFilter" /}
    #{textField name: "adminTo", label: "Admin to", dataBind: "value: emailTarget.adminTo" /}
    #{textField name: "exceptionTo", label: "Exception to", dataBind: "value: emailTarget.exceptionTo" /}
    #{textField name: "feedbackTo", label: "Feedback to", dataBind: "value: emailTarget.feedbackTo" /}
    #{textField name: "registerTo", label: "Register to", dataBind: "value: emailTarget.registerTo" /}
    #{textField name: "systemFrom", label: "System from", dataBind: "value: emailTarget.systemFrom" /}
    #{textField name: "feedbackFrom", label: "Feedback from", dataBind: "value: emailTarget.feedbackFrom" /}

    <div class="actions">
      <div class="wait"></div>
      <button class="save" id="saveButton" type="submit">Save Theme</button>
    </div>

  </form>

</div>

<script type="text/javascript">
  $(document).ready(function() {

    var themeModel = {
      addQueryKeys: ko.observable(""),
      selectedQueryKeys: ko.observableArray([]),
      addItem: function() {
        if (themeModel.addQueryKeys() != "") {
          themeModel.localisedQueryKeys.push(themeModel.addQueryKeys());
          themeModel.addQueryKeys("");
        }
      },
      removeSelected: function() {
          themeModel.localisedQueryKeys.removeAll(themeModel.selectedQueryKeys());
          themeModel.selectedQueryKeys([]);
        }
    };

    $('#saveButton').click(function(event) {
      event.preventDefault();
      handleSubmit('/admin/themes/submit', themeModel, '#themeForm', null, function() { document.location = '/admin/themes'});
    });

    load('/admin/themes/load/${id == None ? "" : id.get()}', themeModel);
  });
</script>
