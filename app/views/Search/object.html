#{extends themeInfo.get('themeLayout') /}

#{set title: systemFields.contains("delving_owner") ? systemFields.apply("delving_owner").get(0) + " | " : "" + systemFields.apply("delving_title").get(0) /}

#{set bodyId: 'object'/}

#{set 'moreScripts'}
<script type='text/javascript' src="@{routes.Assets.at('common/javascripts/seadragon/seadragon-min.js')}"></script>
#{/set}

#{breadcrumbs params:["search":["searchTerm": searchTerm, "returnToResults": returnToResults], "title": ["url":"", "label": systemFields.apply("delving_title").get(0)], "inOrg": ["inOrg": "yes"]], configuration: themeInfo.getConfiguration() /}

<div class="return-to-results">
    <a href="/search?${returnToResults}" rel="nofollow"><i class="icon icon-arrow-left"></i> &{'ui.label.returnToResults'}</a>
</div>

<div class="page-header">
    <h1>${systemFields.apply("delving_title").get(0)}</h1>
</div>

<div class="object-view">
    #{view view: fullView /}
    <div class="related-items"></div>
</div>

*{
<!-- overlayed element -->
<div id="overlay" class="result-overlay" style="padding: 20px;width:auto">
<div class="contentWrap">
    <img src="${systemFields.apply("delving_thumbnail").get(0)}" alt="${systemFields.apply("delving_title").get(0)}" style="max-width:900px" />
    <div class="title"> ${systemFields.apply("delving_title").get(0)}</div>
</div>
</div>
}*
<script type="text/javascript" language="javascript">

$(document).ready(function() {

    if ($('a[data-type=zoom]').size() > 0) {
        // Deepzoom image & viewer
        var zoomImg = $('a[data-type=zoom]').attr('href'), viewer;
        Seadragon.Config.imagePath = "/assets/common/javascripts/seadragon/img/";
        Seadragon.Config.autoHideControls = false;
        viewer = new Seadragon.Viewer("zoom-viewer");
        viewer.openDzi({
            "url":zoomImg,
            "width":1800,
            "height":1400,
            "tileSize":256,
            "tileOverlap":0,
            "tileFormat":"jpg"});
    }
    
    var mltEndpoint = "/organizations/${orgId}/api/search?id=${hubId}&format=json&mlt=true";

    $.get(mltEndpoint, function(data) {
        var rItems = data.result.relatedItems.item, html ='', tmp, org, owner, id, uri;
        console.log(rItems);
        if(rItems){
            html = '<h4>&{'thing.relatedItems'}</h4><ul class="thumbnails">';
            $.each(rItems, function(i, item){
                tmp = item['delving_hubId'].split('_');
                org = tmp[0];
                owner = tmp[1];
                id = tmp[2];
                uri = "/"+org+"/thing/"+owner+"/"+id;
                html += '<li class="thumbnail">'
                html += '<a href="' + uri + '" rel="nofollow"><img class="mlt" src="' + item['delving_thumbnail'] + '" alt="' + item['delving_title'] +'" width="100"/></a></li>';
            });
            html += "</ul>";
            $('.related-items').html(html);
        }
    });
});
</script>
