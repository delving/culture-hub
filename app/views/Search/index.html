#{extends themeInfo.get('themeLayout') /}

#{set title:'Search results' /}

#{set bodyId: 'results' /}

#{set 'moreScripts'}
<script src="@{routes.Assets.at('common/javascripts/results.js')}" type='text/javascript'></script>
#{/set}

#{breadcrumbs params:["search":["searchTerm": searchTerm, "returnToResults": returnToResults]], queryCrumbs: pagination/}



#{if briefDocs }

<div class="row">

    <div class="item-count span6">
        <h6>&{'search.trail', pagination.getStart(), pagination.getLastViewableRecord(), pagination.getNumFound() }</h6>
    </div>

    <div class="facets span6">
        <ul class="nav nav-pills pull-right">
            #{list items: themeFacets, as: 'tf'}
                #{facet facetMap: facets, type: tf.facetName()+'_facet', typeKey: messages.get(tf.facetInternationalisationCode()), qString: pagination.getPresentationQuery().getUserSubmittedQuery(), columns: tf.nrDisplayColumns /}
            #{/list}
        </ul>
    </div>

</div>




    #{if pagination.getNumFound() > views.Helpers.PAGE_SIZE()}
        #{resultPagination pageLinks: pagination, pQuery: pagination.getPresentationQuery().getQueryForPresentation(), extraClass:"pagination-top" /}
    #{/if}


    #{resultGrid results: briefDocs /}

    #{if pagination.getNumFound() > views.Helpers.PAGE_SIZE()}

        #{resultPagination pageLinks: pagination, pQuery: pagination.getPresentationQuery().getQueryForPresentation(), extraClass:"pagination-bottom" /}

    #{/if}

*{#{if userName}}*
*{<div id="dropbox" class="widget object">}*
*{<div class="hd"><h3>&{'search.addItemsToCollection'}</h3></div>}*
*{<div class="bd">}*
*{<div id="dropbox-info"><p>&{'search.dragItems'}</p></div>}*
*{<form action="" method="post" class="dropbox">}*
*{<ul></ul>}*
*{<div id="dropbox-actions">}*
*{#{if collections}}*
*{<select name="collection" id="dropbox-collection">}*
*{<option selected='selected'>&{'user.story.label.selectCollection'}</option>}*
*{#{list collections, as: 'col'}}*
*{<option value="${col.id}">${col.title}</option>}*
*{#{/list}}*
*{</select>}*
*{<hr/>}*
*{<button id="addToCollectionButton" type="submit" class="button action submit">&{'search.addToCollection'}</button>}*
*{#{/if}}*
*{#{else}}*
*{<hr>}*
*{You have no collections. <a href="/${userName}/collection/add">Create a collection</a> so that you can save items into them.}*
*{#{/else}}*
*{</div>}*
*{</form>}*

*{</div>}*
*{</div>}*
*{#{/if}}*
<!-- commented out for now until functionality is there -->
*{<div class="dropdown">}*
*{#{btnHref label: viewUtils.getKey('search.sortby'), toggle:true/}}*
*{<div class="dropdown-slider">}*
*{<a href="#" class="ddm"><span class="label">&{'thing.object'}</span></a>}*
*{<a href="#" class="ddm"><span class="label">&{'thing.collection'}</span></a>}*
*{</div>}*
*{</div>}*

*{</div>}*
</div>

#{/if}

#{else}
<div class="g-12of12 grid_12 centered pam">
&{'ui.message.nothingFound'}
</div>
#{/else}

<!-- overlayed element -->
<div id="overlay" class="result-overlay">
    <!-- the external content is loaded inside this tag -->
    <div class="contentWrap"></div>
</div>

<script type="text/javascript">
    $(document).ready(function () {

//  $('#dropbox').dropbox();
//
//  $('#addToCollectionButton').click(function(event) {
//        event.preventDefault();
//        $('#dropbox input[name="itemId"]').each(function() {
//          var uri = $(this).val();
//          $.ajax({
//            type: 'POST',
//            url: uri + '/link/partOf/collection/' + $('#dropbox-collection').val(),
//            success: function() {
//              $('#dropbox').trigger({
//                type: 'removeItem',
//                itemId: uri
//              });
//            },
//            error: function() {
//                $("select#dropbox-collection").css("background","#cc3300").effect("bounce", { times:4 }, 200);
//                setTimeout('$("select#dropbox-collection").delay(800).css("background","#ffffff")', 1500);
//            }
//          });
//        });
//      });

    });
</script>
