#{extends themeInfo.get('themeLayout') /}

#{set title:'Search results' /}

#{set bodyId: 'results' /}

#{set 'moreCss'}
<link rel="stylesheet" type="text/css" href="@{routes.Assets.at("common/stylesheets/media/media.css")}"/>
#{/set}

#{set 'moreScripts'}
*{<script type='text/javascript' src="@{routes.Assets.at('common/javascripts/jquery.masonry.min.js')}"></script>}*
<script type='text/javascript' src="@{routes.Assets.at('common/javascripts/results.js')}"></script>
#{/set}

#{breadcrumbs params:["search":["searchTerm": searchTerm, "returnToResults": returnToResults]], queryCrumbs: pagination/}

#{if briefDocs }

    <div class="row">
        <div class="item-count span12">
            <h4>&{'search.trail', pagination.getStart(), pagination.getLastViewableRecord(), pagination.getNumFound() }</h4>
        </div>
    </div>

    #{if pagination.getNumFound() > views.Helpers.PAGE_SIZE()}
        #{results.resultPagination pageLinks: pagination, pQuery: pagination.getPresentationQuery().getQueryForPresentation(), searchIn: params.searchIn ? params.searchIn[0] : "text", lastPage: pagination.getNumFound() - pagination.getRows(), extraClass:"pagination-top" /}
    #{/if}

    <div class="row">
        <div class="span9">
            #{results.resultGrid results: briefDocs /}
        </div>
        <div class="span3">
            #{list items: themeFacets, as: 'tf'}
                #{facet facetMap: facets,
                        type: tf.facetName()+'_facet',
                        typeKey: messages.get(tf.facetInternationalisationCode()),
                        qString: pagination.getPresentationQuery().getUserSubmittedQuery(),
                        searchIn: params.searchIn ? params.searchIn[0] : "text",
                        columns: tf.nrDisplayColumns/}
            #{/list}
        </div>
    </div>

    #{if pagination.getNumFound() > views.Helpers.PAGE_SIZE()}
        #{results.resultPagination pageLinks: pagination, pQuery: pagination.getPresentationQuery().getQueryForPresentation(), searchIn: params.searchIn ? params.searchIn[0] : "text", lastPage: pagination.getNumFound() - pagination.getRows(), extraClass:"pagination-bottom" /}
    #{/if}

*{#{if userName}}*
*{<div id="dropbox" class="widget object">}*
*{<div class="hd"><h3>&{'search.addItemsToCollection'}</h3></div>}*
*{<div class="bd">}*
*{<div id="dropbox-info"><p>&{'search.dragItems'}</p></div>}*
*{<form action="" method="post" class="dropbox">}*
*{<ul></ul>}*
*{<div id="dropbox-actions">}*
*{#{if collections}}*
*{<select name="collection" id="dropbox-collection">}*
*{<option selected='selected'>&{'user.story.label.selectCollection'}</option>}*
*{#{list collections, as: 'col'}}*
*{<option value="${col.id}">${col.title}</option>}*
*{#{/list}}*
*{</select>}*
*{<hr/>}*
*{<button id="addToCollectionButton" type="submit" class="button action submit">&{'search.addToCollection'}</button>}*
*{#{/if}}*
*{#{else}}*
*{<hr>}*
*{You have no collections. <a href="/${userName}/collection/add">Create a collection</a> so that you can save items into them.}*
*{#{/else}}*
*{</div>}*
*{</form>}*

*{</div>}*
*{</div>}*
*{#{/if}}*
<!-- commented out for now until functionality is there -->
*{<div class="dropdown">}*
*{#{btnHref label: viewUtils.getKey('search.sortby'), toggle:true/}}*
*{<div class="dropdown-slider">}*
*{<a href="#" class="ddm"><span class="label">&{'thing.object'}</span></a>}*
*{<a href="#" class="ddm"><span class="label">&{'thing.collection'}</span></a>}*
*{</div>}*
*{</div>}*

*{</div>}*
*{</div>}*

#{/if}

#{else}
<div class="span12 centered pam">
&{'ui.message.nothingFound'}
</div>
#{/else}
*{
<!-- overlayed element -->
<div id="overlay" class="result-overlay">
    <!-- the external content is loaded inside this tag -->
    <div class="contentWrap"></div>
</div>


<script type="text/javascript">
//    $(document).ready(function () {

//  $('#dropbox').dropbox();
//
//  $('#addToCollectionButton').click(function(event) {
//        event.preventDefault();
//        $('#dropbox input[name="itemId"]').each(function() {
//          var uri = $(this).val();
//          $.ajax({
//            type: 'POST',
//            url: uri + '/link/partOf/collection/' + $('#dropbox-collection').val(),
//            success: function() {
//              $('#dropbox').trigger({
//                type: 'removeItem',
//                itemId: uri
//              });
//            },
//            error: function() {
//                $("select#dropbox-collection").css("background","#cc3300").effect("bounce", { times:4 }, 200);
//                setTimeout('$("select#dropbox-collection").delay(800).css("background","#ffffff")', 1500);
//            }
//          });
//        });
//      });

//    });
</script>
}*