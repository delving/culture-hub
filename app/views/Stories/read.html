#{extends viewUtils.themeProperty('themeLayout') /}

#{set title: viewUtils.getKey('thing.story') + ' ' + story.name + ' - ' + viewUtils.getKey('thing.owner') + ': ' + browsedFullName /}

#{set bodyId:'read-story' /}

#{set 'moreCss'}
<link rel="stylesheet" type="text/css" href="@{'/public/common/stylesheets/scrollable.css'}"/>
<link rel="stylesheet" type="text/css" href="@{'/public/common/stylesheets/scrollable-nav.css'}"/>
<link rel="stylesheet" type="text/css" href="@{'/public/common/javascripts/mediaelement/build/mediaelementplayer.css'}"/>
#{/set}

#{set 'moreScripts'}
<script src="@{'/public/common/javascripts/mediaelement/build/mediaelement-and-player.js'}"></script>
<script src="@{'/public/common/javascripts/story.js'}" language="javascript"></script>
<script src="@{'/public/common/javascripts/culturehub.media.switch.js'}"></script>
#{/set}

#{breadcrumbs /}

<div class="row">
    <div class="story-wrapper">
        <div class="grid_3">
            <div class="widget">
                <div class="hd"><h3>${story.name}</h3></div>
                <div class="bd pam">
                    <ul id="inav">
                        <li><a class="browse active">&{'story.titlePage'}</a></li>
                        #{list story.pages, as: 'page'}
                        <li><a class="browse" title="${page.title}">${page.title}</a></li>
                        #{/list}
                    </ul>
                </div>
            </div>
            #{if userName == story.userName}
            #{btnHref label: viewUtils.getKey('ui.label.edit'), href: "/"+story.userName+"/story/"+story._id+"/update", iconClass:"icon145", extraClass: "fright" /}
            #{/if}
        </div>
        <div class="story-container grid_9">
            <div class="scroll-nav">
                <div class="pagination">
                    <a class="prev browse">&{'story.previouspage'}</a>
                    <div id="pnav">
                        <a class="browse active">1</a>
                        #{list story.pages, as: 'page'}
                        <a class="browse" title="${page.title}">${page_index + 1}</a>
                        #{/list}
                    </div>
                    <a class="next browse">&{'story.nextpage'}</a>
                </div>
            </div>
            <div class="scrollable" id="story">
                <div class="items">
                    <div class="page title-page" id="page_0">
                        <div class="g-1of1">
                            <div class="centered pam">
                                <h1>${story.name}</h1>
                                <img src="${views.context.package.thumbnailUrl(story.thumbnail_id, 220)}" width="220" alt=""/>
                                <h2>${story.userName}</h2>
                                <p>${story.description}</p>
                            </div>
                        </div>
                    </div>
                    #{list story.pages, as: 'page'}
                    <div class="page pam" id="page_${page_index}">
                        <h2>${page.title}</h2>
                        <div class="page-left g-1of2">
                            ${page.text.raw()}
                        </div>
                        <div class="page-right g-1of2 images">
                            *{#{list page.objects.headOption(), as: 'o'}}*
                            #{list page.getPageObjects(), as: 'o'}
                            #{if o.hubType == 'mdr'}
                                <img src="${o.thumbnail()}" id="img_${o_index}" width="325" alt="${page.title}">
                            #{/}
                            #{else}
                                #{displayFiles files: o.files(), fileWidth:325, thumbWidth: 350, objectName: "test", targetId: o.id() /}
                            #{/}
                            #{/list}
                        </div>
                    </div>
                    #{/list}
                </div>
            </div>
        </div>
    </div>
</div>
<div id="overlay" class="result-overlay" style="padding: 20px;width:auto">
    <div class="contentWrap"></div>
</div>
<script type="text/javascript" language="javascript">
    $(function () {
        mediaSwitch({
            'triggerElement' : '.thumbNav',
            'mediaWidth'     : '325'
        });
        // set media elements
        var player = $('audio, video').mediaelementplayer({
            enableAutosize: true,
            defaultVideoWidth: 325,
            defaultVideoHeight: 240,
            videoWidth: 325,
            videoHeight: -1,
            audioWidth: 325,
            audioHeight: 30,
            plugins: ['flash','silverlight'],
            features: ['playpause','progress','current','duration','volume','fullscreen']
        });
    });
</script>