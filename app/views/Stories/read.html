#{extends viewUtils.themeProperty('themeLayout') /}

#{set title: viewUtils.getKey('thing.story') + ' ' + story.name + ' - ' + viewUtils.getKey('thing.owner') + ': ' + browsedFullName /}

#{set 'moreCss'}
<link rel="stylesheet" type="text/css" href="@{'/public/themes/common/stylesheets/scrollable.css'}"/>
<link rel="stylesheet" type="text/css" href="@{'/public/themes/common/stylesheets/scrollable-nav.css'}"/>
#{/set}

#{set 'moreScripts'}
<script src="@{'/public/themes/common/javascripts/story.js'}" language="javascript"></script>
#{/set}

#{breadcrumbs /}

<div class="row">

    <div class="g-12of12 grid_12 story-wrapper">
        <div class="g-3of12 grid_3 alpha">
            <div class="widget">
                <div class="hd"><h3>${story.name}</h3></div>
                <div class="bd pan">
                    <ul id="inav">
                        <li class="active"><a class="browse page">&{'story.titlePage'}</a></li>
                        #{list story.pages, as: 'page'}
                        <li><a class="browse page" title="${page.title}">${page.title}</a></li>
                        #{/list}
                    </ul>
                </div>
            </div>
            #{if userName == story.userName}
                 #{btnHref label: viewUtils.getKey('ui.label.edit'), href: "/"+story.userName+"/story/"+story._id+"/update", iconClass:"icon145", extraClass: "submit fright" /}
            #{/if}
        </div>

        <div class="g-9of12 grid_9 omega">

            <div class="story-container">

                <div class="scroll-nav">
                    <a class="prev browse">&{'story.previouspage'}</a>
                    <ul id="pnav" class="s-nav">
                        <li class="active"><a class="browse page">1</a></li>
                        #{list story.pages, as: 'page'}
                        <li><a class="browse page" title="${page.title}">${page_index + 1}</a></li>
                        #{/list}
                    </ul>
                    <a class="next browse">&{'story.nextpage'}</a>
                </div>
                <div class="scrollable">

                    <!-- root element for the items -->
                    <div class="items">

                        <div class="row page title-page" id="page_0">

                            <div class="g-1of1">

                                <div class="centered pam">
                                    <h1>${story.name}</h1>
                                    <img src="${views.context.package.thumbnailUrl(story.thumbnail_id, 220)}" width="220" alt=""/>

                                    <h3>By: ${story.userName}</h3>
                                    <p>${story.description}</p>
                                </div>

                            </div>

                        </div>

                        #{list story.pages, as: 'page'}
                        <div class="page row pam" id="page_${page_index}">
                            <h2>${page.title}</h2>

                            <div class="page-left g-1of2 alpha">
                                ${page.text.raw()}
                            </div>
                            <div class="page-right g-1of2 omega">
                                #{list page.objects.headOption(), as: 'o'}
                                <img src="${views.context.package.imageUrl(o.dobject_id)}" width="340" alt="${page.title}">
                                #{/list}
                            </div>

                        </div>
                        #{/list}
                    </div>

                </div>

            </div>
        </div>
    </div>

</div>
